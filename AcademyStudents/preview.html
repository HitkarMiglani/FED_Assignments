<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Academy Gatekeeper — Preview</title>
    <style>
      :root {
        --bg: #0f1724;
        --card: #0b1220;
        --muted: #94a3b8;
        --accent: #06b6d4;
        --glass: rgba(255, 255, 255, 0.03);
        --soft: rgba(255, 255, 255, 0.04);
        color-scheme: dark;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
      }
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        min-height: 100vh;
        background: linear-gradient(180deg, #071025 0%, #041522 60%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 3rem 1rem;
        color: #e6eef6;
      }
      .shell {
        width: min(1100px, 100%);
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.25rem;
      }
      header.app {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        border-radius: 12px;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        box-shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
      }
      .logo {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        background: linear-gradient(135deg, #06b6d4, #2563eb);
        display: grid;
        place-items: center;
        font-weight: 700;
        font-size: 18px;
        color: #041022;
      }
      header.app h1 {
        margin: 0;
        font-size: 1.1rem;
      }
      header.app p {
        margin: 0;
        color: var(--muted);
        font-size: 0.95rem;
      }

      main.grid {
        display: grid;
        grid-template-columns: 360px 1fr;
        gap: 1rem;
        align-items: start;
      }
      .card {
        background: var(--card);
        padding: 1rem;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.03);
        box-shadow: 0 6px 30px rgba(2, 6, 23, 0.7);
      }
      .card h2 {
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
      }

      .status-row {
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }
      .badge {
        padding: 0.35rem 0.6rem;
        border-radius: 999px;
        background: var(--soft);
        font-weight: 600;
        color: var(--muted);
        font-size: 0.85rem;
      }
      .btn {
        background: linear-gradient(90deg, #06b6d4, #2563eb);
        color: #021226;
        border: none;
        padding: 0.55rem 0.9rem;
        border-radius: 10px;
        font-weight: 700;
        cursor: pointer;
      }
      .btn.ghost {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.04);
        color: var(--muted);
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
      }
      label {
        display: flex;
        flex-direction: column;
        font-weight: 600;
        color: #cfe7f6;
      }
      input {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.06);
        padding: 0.6rem;
        border-radius: 8px;
        color: inherit;
      }

      .outputs {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
      }
      pre.out {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.2)
        );
        padding: 0.8rem;
        border-radius: 8px;
        color: #dff7fb;
        white-space: pre-wrap;
        max-height: 260px;
        overflow: auto;
        border: 1px solid rgba(255, 255, 255, 0.02);
      }

      /* responsive */
      @media (max-width: 980px) {
        main.grid {
          grid-template-columns: 1fr;
        }
      }

      /* subtle toast */
      .toast {
        position: fixed;
        right: 20px;
        bottom: 20px;
        background: #04202a;
        padding: 0.8rem 1rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        box-shadow: 0 10px 30px rgba(2, 6, 23, 0.7);
        color: #bfeef8;
        display: none;
      }
      .toast.show {
        display: block;
      }

      .row {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header class="app">
        <div class="logo">AG</div>
        <div>
          <h1>Academy Gatekeeper — Preview</h1>
          <p>
            Try signup and login locally. Keep the server running at port 3000.
          </p>
        </div>
      </header>

      <main class="grid">
        <aside class="card">
          <h2>Server status</h2>
          <div class="row status-row">
            <button id="ping-btn" class="btn">Ping API</button>
            <div class="badge" id="status-text">Waiting…</div>
            <button id="clear-btn" class="btn ghost" title="Clear outputs">
              Clear
            </button>
          </div>
          <div style="height: 8px"></div>
          <pre id="status-output" class="out"></pre>
        </aside>

        <section>
          <div class="card" style="margin-bottom: 1rem">
            <h2>Signup</h2>
            <form id="signup-form">
              <label
                >Name
                <input
                  name="name"
                  placeholder="Ada Lovelace"
                  autocomplete="username"
                  required
              /></label>
              <label
                >Password
                <input
                  type="password"
                  name="password"
                  placeholder="At least 6 characters"
                  autocomplete="new-password"
                  required
              /></label>
              <div style="display: flex; gap: 0.6rem; margin-top: 0.4rem">
                <button type="submit" class="btn">Register student</button>
                <button type="button" id="signup-sample" class="btn ghost">
                  Use sample
                </button>
              </div>
            </form>
            <div style="height: 10px"></div>
            <div class="outputs">
              <pre id="signup-output" class="out">(no signup attempts yet)</pre>
            </div>
          </div>

          <div class="card">
            <h2>Login</h2>
            <form id="login-form">
              <label
                >Name
                <input
                  name="name"
                  placeholder="Ada Lovelace"
                  autocomplete="username"
                  required
              /></label>
              <label
                >Password
                <input
                  type="password"
                  name="password"
                  placeholder="Your secret"
                  autocomplete="current-password"
                  required
              /></label>
              <div style="display: flex; gap: 0.6rem; margin-top: 0.4rem">
                <button type="submit" class="btn">Let me in</button>
                <button type="button" id="login-sample" class="btn ghost">
                  Use sample
                </button>
              </div>
            </form>
            <div style="height: 10px"></div>
            <div class="outputs">
              <pre id="login-output" class="out">(no login attempts yet)</pre>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script>
      const API_BASE = "http://localhost:3000";

      const pingBtn = document.querySelector("#ping-btn");
      const statusText = document.querySelector("#status-text");
      const statusOutput = document.querySelector("#status-output");
      const signupForm = document.querySelector("#signup-form");
      const signupOutput = document.querySelector("#signup-output");
      const loginForm = document.querySelector("#login-form");
      const loginOutput = document.querySelector("#login-output");
      const clearBtn = document.querySelector("#clear-btn");
      const toast = document.querySelector("#toast");

      function showToast(message, timeout = 2500) {
        toast.textContent = message;
        toast.classList.add("show");
        clearTimeout(window._toastTimer);
        window._toastTimer = setTimeout(
          () => toast.classList.remove("show"),
          timeout
        );
      }

      function pretty(data) {
        try {
          return JSON.stringify(data, null, 2);
        } catch (e) {
          return String(data);
        }
      }

      function setOutput(el, res) {
        if (!res) return (el.textContent = "(no response)");
        const { status, statusText, body } = res;
        el.textContent = `${status} ${statusText}\n\n${pretty(body)}`;
        if (status >= 200 && status < 300)
          el.style.borderLeft = "4px solid #06b6d4";
        else if (status >= 400 && status < 500)
          el.style.borderLeft = "4px solid #f97316";
        else el.style.borderLeft = "4px solid #ef4444";
      }

      async function apiRequest(endpoint, payload, outputElement, button) {
        button.disabled = true;
        const original = button.textContent;
        button.textContent = "…";
        try {
          const response = await fetch(API_BASE + endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const text = await response.text();
          let body;
          try {
            body = JSON.parse(text);
          } catch (e) {
            body = { raw: text };
          }
          setOutput(outputElement, {
            status: response.status,
            statusText: response.statusText,
            body,
          });
          showToast(`${endpoint} → ${response.status} ${response.statusText}`);
        } catch (err) {
          outputElement.textContent = "Network error: " + err.message;
          outputElement.style.borderLeft = "4px solid #ef4444";
          showToast("Network error");
        } finally {
          button.disabled = false;
          button.textContent = original;
        }
      }

      async function pingApi() {
        statusText.textContent = "Contacting…";
        statusOutput.textContent = "Loading…";
        try {
            console.log("Pinging API at", API_BASE + "/");
          const res = await fetch(API_BASE + "/");
          const text = await res.text();
          // Try to parse JSON, but fall back to raw text (HTML error pages, etc.)
          try {
            const parsed = JSON.parse(text);
            statusOutput.textContent = pretty(parsed);
          } catch (_e) {
            statusOutput.textContent = text;
          }
          statusText.textContent = `Online (${res.status})`;
          statusOutput.style.borderLeft = res.ok
            ? "4px solid #10b981"
            : "4px solid #f59e0b";
        } catch (err) {
          statusText.textContent = "Offline";
          statusOutput.textContent = "Network error: " + err.message;
          statusOutput.style.borderLeft = "4px solid #ef4444";
        }
      }

      signupForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const form = new FormData(signupForm);
        const payload = Object.fromEntries(form.entries());
        apiRequest(
          "/signup",
          payload,
          signupOutput,
          signupForm.querySelector("button")
        );
      });
      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const form = new FormData(loginForm);
        const payload = Object.fromEntries(form.entries());
        apiRequest(
          "/login",
          payload,
          loginOutput,
          loginForm.querySelector("button")
        );
      });

      document.querySelector("#signup-sample").addEventListener("click", () => {
        signupForm.name.value =
          "Student_" + Math.floor(Math.random() * 900 + 100);
        signupForm.password.value = "secret123";
        showToast("Sample filled — submit to register");
      });
      document.querySelector("#login-sample").addEventListener("click", () => {
        loginForm.name.value = "Alice";
        loginForm.password.value = "secret123";
        showToast("Sample filled — submit to login");
      });

      clearBtn.addEventListener("click", () => {
        statusOutput.textContent = "(no data yet)";
        signupOutput.textContent = "(no signup attempts yet)";
        loginOutput.textContent = "(no login attempts yet)";
        showToast("Cleared outputs");
      });

      pingBtn.addEventListener("click", pingApi);
      // initial ping
      pingApi();
    </script>
  </body>
</html>
